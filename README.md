<h1 align="center">Документоборот</h1>

### I. Описание приложения и функционала

Приложение призвано упростить процесс документооборота в делопроизводстве.
Для начала работы необходимо зарегистрировать сотрудника. Регистрация производится на веб-странице по эндпоинту `/register`.
После успешной регистрации необходимо войти в систему через веб-страницу по эндпоинту `/login`,
используя данные, указанные при регистрации: имя пользователя и пароль. Для аутентификации при доступе к эндпоинтам API
также поддерживается `Basic Auth`. Для демонстрации приложения также можно использовать начальные данные, уже существующие в системе:

1. Администратор (Username: `admin` Password: `testpass`)
2. Сотрудник с начальными правами (Username: `ilya1901` Password: `testpass`)
3. Сотрудник с начальными правами ( Username: `alex999` Password: `testpass`)

Данные сотрудники уже имеют созданные документы и выстроенные цепочки задач.

Сотрудник может выпустить документ, а также настроить маршрут его движения внутри организации.
Любой документ имеет связанный с ним файл (в большинстве случае используется документ с расширением .docx) а также тип документа.
Тип документа это просто сущность, служащая как мета-данные. Стартовый набор данных в приложении уже имеет несколько типов:
`Договор`, `Счёт-фактура`, `Товарная накладная`. Дополнительные позиции в справочник может добавить администратор,
воспользовавшись эндпоинтом `/api/v1/document-types/document-type`, используя HTTP-метод `POST`.
Файл тоже является сущностью, в базе данных `Postgres` хранится мета-данные файла, а сам файл хранится на сервере `MinIO`,
полностью совместимом с сервисом-хранилищем S3, разработанном Amazon. По ходу перемещения документа от сотрудника к сотруднику,
как правило, именно файл документа будет подвергаться различным правкам.

Для создания документа необходимо сделать запрос на эндпоинт `/api/v1/documents/document`, используя HTTP-метод `POST`.
Стоит заметить, что в теле запроса необходимо будет указать ID файла-черновика. Для загрузки файла на сервер,
необходимо обратиться по эндпоинту `/api/v1/files/file/draft`, используя метод HTTP-метод `POST`.
В теле запроса необходимо указать имя файла и его MIME-тип (фронтэнд должен сообщить бэкэнду о планируемой загрузке файла).
Таким образом, будет создан файл-черновик, используемый для загрузки ещё неподтверждённого файла. Файл-черновик имеет срок жизни - 24 часа
(или меньше, если черновик будет использован при создании документа). По истечении данного срока, планировщик удалит мета-данные
из базы данных, а MinIO автоматически удалит сам файл в хранилище. Ответом на запрос станут: ID черновика, URL и данные для загрузки файла,
используемые для нового запроса с FormData, в котором также неоходимо указать само содержимое файла. В случае работы с Postman,
запрос будет выглядить так:

![postman-upload-file](https://github.com/user-attachments/assets/c160d2e2-4818-4108-913d-304fc3c9d3c2)

После успешной загрузки файла, можно указать ID черновика в теле запроса на создание документа, ответом станет созданный документ
с ID файла, который связан с документом. При создании документа, приложение копирует содержимое черновика в новый файл,
ID которого будет связано с документом и он уже не будет иметь срока действия. Получить URL на скачивание файла можно
с помощью эндпоинта `/api/v1/files/file/{fileId}`.

Для взаимодействия сотрудников с документом, необходимо настроить маршрут его движения. Делается это с помощью сущности Задача.
Создатель документа может выпустить множество задач, выполнение которых будет происходить последовательно (из-за цели синхронной обработки
документа, для одного документа может быть активна для выполнения только одна задача). При создании задачи, указывается
её предок (предыдущая задача), что позволяет встраивать новые задачи уже в существующую цепочку задач. Чтобы создать задачу,
нужно сделать запрос на эндпоинт `/api/v1/tasks/task`, используя HTTP-метод `POST`. Задача обращена к указанному сотруднику,
который должен совершить определённое действие, таким образом выполнив задачу. Его действием может быть: `подписать`, `редактировать`,
`выпустить новый документ и связать с указанным в задаче документом`, `подтвердить качество выпущенных дочерних документов`
(если задачи для них всё ещё активны, подтверждение невозможно), `подтвердить отправку письма по электронной почте`
(согласно выбранному шаблону). Действие может быть исполнено при запросе на соответствующий эндпоинт. Также задачу можно отклонить,
чтобы отправить на доработку сотруднику, который её выпустил. После выполнения задачи, следующая после неё задача станет активна
и доступна для выполнения другому сотруднику. У задачи должен быть один из статусов:
`Ожидает предыдущей задачи` (задача не доступна для выполнения), `Выполняется` (задача ожидает выполнения сотрудником),
`Выполнена`, `Отклонена`. Статус задачи конкретной задачи не может быть изменен сотрудником, он автоматически выдаётся приложением.
Создатель документа может лишь активировать заданную цепочку задач по эндпоинту `/api/v1/tasks/activate-chain`. Это действие выставит
статус `Выполняется` первой задаче в очереди ожидания, таким образом запустив процесс последовательной обработки документа.

У одной задачи может быть лишь один предок (предыдущая задача) и лишь один потомок (следующая задача), что ещё раз иллюстрирует набор
обращённых к одному документу задач в виде цепочки задач. При этом набор документов может быть представлен в виде дерева с неограниченным
количеством веток у каждой ветки.

==================

###  II. Запускаем приложение
1. Клонируем проект в среду разработки IntelliJ Idea
2. В настройках проекта должна стоять Java 21 и должен быть запущен Docker Desktop.
3. Должны быть заданы переменные окружения для Maven:
`Build, Execution, Deployment` -> `Build Tools` -> `Maven` -> `Runner`

![2024-09-09 01-28-38 Environment Variables](https://github.com/user-attachments/assets/e0f76677-4795-4477-b612-fa15ec3f2a58)

4. Запускается программа как и любое другое Spring Boot приложение: командой `mvn spring-boot:run`
5. Дождаться загрузки

### III. Схема структуры базы данных

![image](https://github.com/user-attachments/assets/ae79ac43-1ef7-4cc6-978d-02fbb2ce9b6b)

### IV. Использованные технологии и их версии

* Java - 21
* Spring - 6.11.1
* Spring Boot - 3.3.2
* Postgres - 16.4
* Liquibase - 4.27.0
* Lombok - 1.18.34
* Mapstruct - 1.6.0.Beta1
* Docker Desktop - 4.33.1
* Redis - 7.4.0
* Minio - 9.4

==========================


